qqq <- qqq[,c(2,1)]
qqq
writexl::write_xlsx(qqq,"qqq.xlsx")
variable_en_estudio <- function(dataset){
variable <- switch(i,"E8T","E7T","e6a","e6a","e6a","e6a","e6a")
dataset[,variable][dataset[,variable]==	'Educación Media Científico-Humanística']                           <- "media"
dataset[,variable][dataset[,variable]==	'Educación Media Técnica Profesional']                              <- "media"
dataset[,variable][dataset[,variable]==	'Educación Básica']                                                 <- "basica"
dataset[,variable][dataset[,variable]==	'Ninguno']                                                          <- "NA"
dataset[,variable][dataset[,variable]==	'Preparatoria (Sistema Antiguo)']                                   <- "basica"
dataset[,variable][dataset[,variable]==	'Educación Preescolar o Educación Parvularia']                      <- "basica"
dataset[,variable][dataset[,variable]==	'Instituto Profesional completa (con título)']                      <- "profesional"
dataset[,variable][dataset[,variable]==	'Educación Universitaria completa (con título)']                    <- "universitaria"
dataset[,variable][dataset[,variable]==	'Centro de Formación Técnica completa ( con título)']               <- "universitaria"
dataset[,variable][dataset[,variable]==	'Instituto Profesional incompleta (sin título)']                    <- "universitaria"
dataset[,variable][dataset[,variable]==	'Humanidades (Sistema Antiguo)']                                    <- "media"
dataset[,variable][dataset[,variable]==	'Educación Universitaria incompleta (sin título)']                  <- "universitaria"
dataset[,variable][dataset[,variable]==	'Centro de Formación Técnica incompleta (sin título)']              <- "universitaria"
dataset[,variable][dataset[,variable]==	'Escuela Especial (Diferencial)']                                   <- "basica"
dataset[,variable][dataset[,variable]==	'Universitaria de Postgrado']                                       <- "universitaria"
dataset[,variable][dataset[,variable]==	'Técnica, Comercial, Industrial o Normalista (Sist. Antiguo)']      <- "media"
dataset[,variable][dataset[,variable]==	'Sin dato']                                                         <- "NA"
dataset[,variable][dataset[,variable]==	'NA']                                                               <- "NA"
dataset[,variable][dataset[,variable]==	'Humanidades (Sistema Antiguo)']                                    <- "media"
dataset[,variable][dataset[,variable]==	'Preparatoria (Sistema Antiguo)']                                   <- "basica"
dataset[,variable][dataset[,variable]==	'Educación Media Científico-Humanística']                           <- "media"
dataset[,variable][dataset[,variable]==	'Educación Básica']                                                 <- "basica"
dataset[,variable][dataset[,variable]==	'Educación Media Técnica Profesional']                              <- "media"
dataset[,variable][dataset[,variable]==	'Educación Universitaria completa (con título)']                    <- "universitaria"
dataset[,variable][dataset[,variable]==	'Educación Universitaria incompleta (sin título)']                  <- "universitaria"
dataset[,variable][dataset[,variable]==	'Educación Preescolar o Educación Parvularia']                      <- "basica"
dataset[,variable][dataset[,variable]==	'Instituto Profesional completo (con título)']                      <- "universitaria"
dataset[,variable][dataset[,variable]==	'Centro de Formación Técnica incompleta (sin título)']              <- "universitaria"
dataset[,variable][dataset[,variable]==	'Centro de Formación Técnica completa (con título)']                <- "universitaria"
dataset[,variable][dataset[,variable]==	'Instituto Profesional incompleto (sin título)']                    <- "universitaria"
dataset[,variable][dataset[,variable]==	'Técnica, Comercial, Industrial o Normalista (Sistema Antiguo']     <- "media"
dataset[,variable][dataset[,variable]==	'Ninguno']                                                          <- "NA"
dataset[,variable][dataset[,variable]==	'Escuela Especial (Diferencial)']                                   <- "basica"
dataset[,variable][dataset[,variable]==	'Universitaria de Postgrado']                                       <- "universitaria"
dataset[,variable][dataset[,variable]==	'NA']                                                               <- "NA"
dataset[,variable][dataset[,variable]==	'Humanidades (sistema antiguo)']                                    <- "media"
dataset[,variable][dataset[,variable]==	'Primaria/Preparatoria (sistema antiguo)']                          <- "basica"
dataset[,variable][dataset[,variable]==	'Profesional']                                                      <- "universitaria"
dataset[,variable][dataset[,variable]==	'Educación Media Científico-Humanista']                             <- "media"
dataset[,variable][dataset[,variable]==	'Técnico Nivel Superior']                                           <- "universitaria"
dataset[,variable][dataset[,variable]==	'Educación Básica']                                                 <- "basica"
dataset[,variable][dataset[,variable]==	'Kinder/Pre-kinder']                                                <- "basica"
dataset[,variable][dataset[,variable]==	'Postgrado']                                                        <- "universitaria"
dataset[,variable][dataset[,variable]==	'Educación Media Técnica Profesional']                              <- "media"
dataset[,variable][dataset[,variable]==	'Nunca asistió']                                                    <- "NA"
dataset[,variable][dataset[,variable]==	'Jardín infantil/Sala cuna']                                        <- "basica"
dataset[,variable][dataset[,variable]==	'Técnica, Comercial, Industrial o Normalista']                      <- "media"
dataset[,variable][dataset[,variable]==	'Educación especial (diferencial)']                                 <- "basica"
dataset[,variable][dataset[,variable]==	'NA']                                                               <- "NA"
dataset[,variable][dataset[,variable]==	'Primaria/Preparatoria (sistema antiguo)']                          <- "basica"
dataset[,variable][dataset[,variable]==	'Educación Media Técnica Profesional']                              <- "media"
dataset[,variable][dataset[,variable]==	'Educación Media Científico-Humanista']                             <- "media"
dataset[,variable][dataset[,variable]==	'Técnico Nivel Superior (carreras de 1 a 3 años)']                  <- "universitaria"
dataset[,variable][dataset[,variable]==	'Profesional (carreras de 4 o más años)']                           <- "universitaria"
dataset[,variable][dataset[,variable]==	'Educación Básica']                                                 <- "basica"
dataset[,variable][dataset[,variable]==	'Humanidades (sistema antiguo)']                                    <- "media"
dataset[,variable][dataset[,variable]==	'Jardín infantil/Sala cuna']                                        <- "basica"
dataset[,variable][dataset[,variable]==	'Técnica, Comercial, Industrial o Normalista (sistema antiguo)']    <- "media"
dataset[,variable][dataset[,variable]==	'Educación especial (diferencial)']                                 <- "basica"
dataset[,variable][dataset[,variable]==	'Nunca asistió']                                                    <- "NA"
dataset[,variable][dataset[,variable]==	'Kinder/Pre-kinder']                                                <- "basica"
dataset[,variable][dataset[,variable]==	'Postgrado']                                                        <- "universitaria"
dataset[,variable][dataset[,variable]==	'NS/NR']                                                            <- "NA"
dataset[,variable][dataset[,variable]==	'NA']                                                               <- "NA"
dataset[,variable][dataset[,variable]==	'Educación Media Científico-Humanista']                             <- "media"
dataset[,variable][dataset[,variable]==	'Educación Media Técnica Profesional']                              <- "media"
dataset[,variable][dataset[,variable]==	'Educación Básica']                                                 <- "basica"
dataset[,variable][dataset[,variable]==	'Nunca asistió']                                                    <- "NA"
dataset[,variable][dataset[,variable]==	'Primaria o Preparatoria (Sistema Antiguo)']                        <- "basica"
dataset[,variable][dataset[,variable]==	'Prekinder / Kinder (Transición menor y Transición Mayor)']         <- "basica"
dataset[,variable][dataset[,variable]==	'Profesional Completo (Carreras 4 ó más años)']                     <- "universitaria"
dataset[,variable][dataset[,variable]==	'Humanidades (Sistema Antiguo)']                                    <- "media"
dataset[,variable][dataset[,variable]==	'Técnico Nivel Superior Completo (Carreras 1 a 3 años)']            <- "universitaria"
dataset[,variable][dataset[,variable]==	'Profesional Incompleto (Carreras 4 ó más años)']                   <- "universitaria"
dataset[,variable][dataset[,variable]==	'Técnica, Comercial, Industrial o Normalista (Sistema Antiguo']     <- "media"
dataset[,variable][dataset[,variable]==	'Técnico Nivel Superior Incompleto (Carreras 1 a 3 años)']          <- "universitaria"
dataset[,variable][dataset[,variable]==	'Postgrado Completo']                                               <- "universitaria"
dataset[,variable][dataset[,variable]==	'Jardín Infantil (Medio menor y Medio mayor)']                      <- "basica"
dataset[,variable][dataset[,variable]==	'Educación Especial (Diferencial)']                                 <- "basica"
dataset[,variable][dataset[,variable]==	'Sala cuna']                                                        <- "basica"
dataset[,variable][dataset[,variable]==	'Postgrado Incompleto']                                             <- "universitaria"
dataset[,variable][dataset[,variable]==	'sin dato']                                                         <- "NA"
dataset[,variable][dataset[,variable]==	'Educación Media Científico-Humanista']                             <- "media"
dataset[,variable][dataset[,variable]==	'Técnico Nivel Superior Completo (Carreras 1 a 3 años)']            <- "universitaria"
dataset[,variable][dataset[,variable]==	'Educación Media Técnica Profesional']                              <- "media"
dataset[,variable][dataset[,variable]==	'Humanidades (Sistema Antiguo)']                                    <- "media"
dataset[,variable][dataset[,variable]==	'Educación Básica']                                                 <- "basica"
dataset[,variable][dataset[,variable]==	'Profesional Incompleto (Carreras 4  o más años)']                  <- "universitaria"
dataset[,variable][dataset[,variable]==	'Profesional Completo (Carreras 4 o más años)']                     <- "universitaria"
dataset[,variable][dataset[,variable]==	'Sala cuna']                                                        <- "basica"
dataset[,variable][dataset[,variable]==	'Postgrado Completo']                                               <- "universitaria"
dataset[,variable][dataset[,variable]==	'Técnica, Comercial, Industrial o Normalista (Sistema Antiguo']     <- "media"
dataset[,variable][dataset[,variable]==	'Primaria o Preparatoria (Sistema antiguo)']                        <- "basica"
dataset[,variable][dataset[,variable]==	'Nunca asistió']                                                    <- "NA"
dataset[,variable][dataset[,variable]==	'Jardín Infantil (Medio menor y Medio mayor)']                      <- "basica"
dataset[,variable][dataset[,variable]==	'Prekinder/Kinder (Transición menor y Transición Mayor)']           <- "basica"
dataset[,variable][dataset[,variable]==	'Técnico Nivel Superior Incompleto (Carreras 1 a 3 años)']          <- "universitaria"
dataset[,variable][dataset[,variable]==	'Postgrado Incompleto']                                             <- "universitaria"
dataset[,variable][dataset[,variable]==	'No sabe/no responde']                                              <- "NA"
dataset[,variable][dataset[,variable]==	'Educación Especial (Diferencial)']                                 <- "basica"
dataset[,variable][dataset[,variable]==	'Educación Media Científico-Humanista']                             <- "media"
dataset[,variable][dataset[,variable]==	'Educación Especial (Diferencial)']                                 <- "basica"
dataset[,variable][dataset[,variable]==	'Educación Básica']                                                 <- "basica"
dataset[,variable][dataset[,variable]==	'Técnico Nivel Superior Incompleto (Carreras 1 a 3 años)']          <- "universitaria"
dataset[,variable][dataset[,variable]==	'Técnico Nivel Superior Completo (Carreras 1 a 3 años)']            <- "universitaria"
dataset[,variable][dataset[,variable]==	'Técnica Comercial, Industrial o Normalista (Sistema Antiguo)']     <- "media"
dataset[,variable][dataset[,variable]==	'Humanidades (Sistema Antiguo)']                                    <- "media"
dataset[,variable][dataset[,variable]==	'Profesional Incompleto (Carreras 4 ó más años)']                   <- "universitaria"
dataset[,variable][dataset[,variable]==	'Educación Media Técnica Profesional']                              <- "media"
dataset[,variable][dataset[,variable]==	'Profesional Completo (Carreras 4 ó más años)']                     <- "universitaria"
dataset[,variable][dataset[,variable]==	'Jardín Infantil (Medio menor y Medio mayor)']                      <- "basica"
dataset[,variable][dataset[,variable]==	'Nunca asistió']                                                    <- "NA"
dataset[,variable][dataset[,variable]==	'Prekínder / Kínder (Transición menor y Transición Mayor)']         <- "basica"
dataset[,variable][dataset[,variable]==	'Postgrado Incompleto']                                             <- "universitaria"
dataset[,variable][dataset[,variable]==	'Sala cuna']                                                        <- "basica"
dataset[,variable][dataset[,variable]==	'Primaria o Preparatoria (Sistema antiguo)']                        <- "basica"
dataset[,variable][dataset[,variable]==	'Postgrado Completo']                                               <- "universitaria"
dataset[,variable][dataset[,variable]==	'NA']                                                               <- "NA"
switch(i,
case =  casen_2006 <<- dataset,
case =  casen_2009 <<- dataset,
case =  casen_2011 <<- dataset,
case =  casen_2013 <<- dataset,
case =  casen_2015 <<- dataset,
case =  casen_2017 <<- dataset,
case =  casen_2020 <<- dataset
)
}
for (i in 1:7) {
switch(i,
case = casen <- casen_2006,
case = casen <- casen_2009,
case = casen <- casen_2011,
case = casen <- casen_2013,
case = casen <- casen_2015,
case = casen <- casen_2017,
case = casen <- casen_2020
)
variable_en_estudio(casen)
}
ab <- casen_2006
b <- ab$COMUNA
c <- ab$E8T
d <- ab$T4
e <- ab$SEXO
f <- ab$E1
cross_tab =  xtabs(ab$EXPC ~   unlist(b) + unlist(c)  + unlist(d) + unlist(e)  + unlist(f),aggregate(ab$EXPC ~  unlist(b) + unlist(c) + unlist(d) + unlist(e) + unlist(f) ,ab,mean))
tabla <- as.data.frame(cross_tab)
d <-tabla[!(tabla$Freq == 0),]
d$anio <- "2006"
names(d)[1] <- "comuna"
names(d)[2] <- "Variable"
names(d)[3] <- "Etnia"
names(d)[4] <- "Sexo"
names(d)[5] <- "Sabe leer?"
names(d)[6] <- "Frecuencia"
names(d)[7] <- "Año"
d_2006 <- d
d_2006 <- mutate_if(d_2006, is.factor, as.character)
ab <- casen_2009
b <- ab$COMUNA
c <- ab$E7T
d <- ab$T5
e <- ab$SEXO
f <- ab$E1
cross_tab =  xtabs(ab$EXPC~   unlist(b) + unlist(c)  + unlist(d) + unlist(e)  + unlist(f),aggregate(ab$EXPC ~  unlist(b) + unlist(c) + unlist(d) + unlist(e) + unlist(f) ,ab,mean))
tabla <- as.data.frame(cross_tab)
d <-tabla[!(tabla$Freq == 0),]
d$anio <- "2009"
names(d)[1] <- "comuna"
names(d)[2] <- "Variable"
names(d)[3] <- "Etnia"
names(d)[4] <- "Sexo"
names(d)[5] <- "Sabe leer?"
names(d)[6] <- "Frecuencia"
names(d)[7] <- "Año"
d_2009 <- d
d_2009 <- mutate_if(d_2009, is.factor, as.character)
ab <- casen_2011
b <- ab$comuna
c <- ab$e6a
d <- ab$r6
e <- ab$sexo
f <- ab$e1
cross_tab =  xtabs(ab$expc_full ~   unlist(b) + unlist(c)  + unlist(d) + unlist(e)  + unlist(f),aggregate(ab$expc_full ~  unlist(b) + unlist(c) + unlist(d) + unlist(e) + unlist(f) ,ab,mean))
tabla <- as.data.frame(cross_tab)
d <-tabla[!(tabla$Freq == 0),]
d$anio <- "2011"
names(d)[1] <- "comuna"
names(d)[2] <- "Variable"
names(d)[3] <- "Etnia"
names(d)[4] <- "Sexo"
names(d)[5] <- "Sabe leer?"
names(d)[6] <- "Frecuencia"
names(d)[7] <- "Año"
d_2011 <- d
d_2011 <- mutate_if(d_2011, is.factor, as.character)
ab <- casen_2013
b <- ab$comuna
c <- ab$e6a
d <- ab$r6
e <- ab$sexo
f <- ab$e1
cross_tab =  xtabs(ab$expc ~   unlist(b) + unlist(c)  + unlist(d) + unlist(e)  + unlist(f),aggregate(ab$expc ~  unlist(b) + unlist(c) + unlist(d) + unlist(e) + unlist(f) ,ab,mean))
tabla <- as.data.frame(cross_tab)
d <-tabla[!(tabla$Freq == 0),]
d$anio <- "2013"
names(d)[1] <- "comuna"
names(d)[2] <- "Variable"
names(d)[3] <- "Etnia"
names(d)[4] <- "Sexo"
names(d)[5] <- "Sabe leer?"
names(d)[6] <- "Frecuencia"
names(d)[7] <- "Año"
d_2013 <- d
d_2013 <- mutate_if(d_2013, is.factor, as.character)
ab <- casen_2015
b <- ab$comuna
c <- ab$e6a
d <- ab$r3
e <- ab$sexo
f <- ab$e1
cross_tab =  xtabs(ab$expc_todas ~   unlist(b) + unlist(c)  + unlist(d) + unlist(e)  + unlist(f),aggregate(ab$expc_todas ~  unlist(b) + unlist(c) + unlist(d) + unlist(e) + unlist(f) ,ab,mean))
tabla <- as.data.frame(cross_tab)
d <-tabla[!(tabla$Freq == 0),]
d$anio <- "2015"
names(d)[1] <- "comuna"
names(d)[2] <- "Variable"
names(d)[3] <- "Etnia"
names(d)[4] <- "Sexo"
names(d)[5] <- "Sabe leer?"
names(d)[6] <- "Frecuencia"
names(d)[7] <- "Año"
d_2015 <- d
d_2015 <- mutate_if(d_2015, is.factor, as.character)
ab <- casen_2017
b <- ab$comuna
c <- ab$e6a
d <- ab$r3
e <- ab$sexo
f <- ab$e1
cross_tab =  xtabs(ab$expc ~   unlist(b) + unlist(c)  + unlist(d) + unlist(e)  + unlist(f),aggregate(ab$expc ~  unlist(b) + unlist(c) + unlist(d) + unlist(e) + unlist(f) ,ab,mean))
tabla <- as.data.frame(cross_tab)
d <-tabla[!(tabla$Freq == 0),]
d$anio <- "2017"
names(d)[1] <- "comuna"
names(d)[2] <- "Variable"
names(d)[3] <- "Etnia"
names(d)[4] <- "Sexo"
names(d)[5] <- "Sabe leer?"
names(d)[6] <- "Frecuencia"
names(d)[7] <- "Año"
d_2017 <- d
d_2017 <- mutate_if(d_2017, is.factor, as.character)
ab <- casen_2020
b <- ab$comuna
c <- ab$e6a
d <- ab$r3
e <- ab$sexo
f <- ab$e1
cross_tab =  xtabs(ab$expc ~   unlist(b) + unlist(c)  + unlist(d) + unlist(e) + unlist(f) ,aggregate(ab$expc ~  unlist(b) + unlist(c) + unlist(d) + unlist(e)  + unlist(f),ab,mean))
tabla <- as.data.frame(cross_tab)
d <-tabla[!(tabla$Freq == 0),]
d$anio <- "2020"
names(d)[1] <- "comuna"
names(d)[2] <- "Variable"
names(d)[3] <- "Etnia"
names(d)[4] <- "Sexo"
names(d)[5] <- "Sabe leer?"
names(d)[6] <- "Frecuencia"
names(d)[7] <- "Año"
d_2020 <- d
d_2020 <- mutate_if(d_2020, is.factor, as.character)
d_2020$`Sabe leer?`[d_2020$`Sabe leer?` == 0] <- "Sí"
d_2020$`Sabe leer?`[d_2020$`Sabe leer?` == 1] <- "No"
d_2020 <- mutate_if(d_2020, is.factor, as.character)
union_e <- rbind(d_2006,d_2009, d_2011, d_2013, d_2015, d_2017,d_2020)
union_e <- mutate_if(union_e, is.factor, as.character)
union_e
cod_com <- readRDS("C:/Users/chris/Desktop/archivos grandes/codigos_comunales_2006-2020.rds")
names(cod_com)[2] <- "comuna"
cod_com
total <- merge(union_e ,cod_com,by=c("comuna"))
total
total$cod_etnia[total$Etnia == "No pertenece a ningún pueblo indígena" ]  <- "1"
total$cod_etnia[total$Etnia == "Mapuche" ]  <- "2"
total$cod_etnia[total$Etnia == "Diaguita" ]  <- "3"
total$cod_etnia[total$Etnia == "No sabe o no responde" ]  <- "4"
total$cod_etnia[total$Etnia == "Atacameño" ]  <- "5"
total$cod_etnia[total$Etnia == "Aymara" ]  <- "6"
total$cod_etnia[total$Etnia == "Coya" ]  <- "7"
total$cod_etnia[total$Etnia == "Quechua" ]  <- "8"
total$cod_etnia[total$Etnia == "Alacalufe" ]  <- "9"
total$cod_etnia[total$Etnia == "Sin dato" ]  <- "10"
total$cod_etnia[total$Etnia == "Pascuense" ]  <- "11"
total$cod_etnia[total$Etnia == "Chango" ]  <- "12"
total$cod_etnia[total$Etnia == "Yagán" ]  <- "13"
total$cod_sexo[total$Sexo == "Hombre"] <- "1"
total$cod_sexo[total$Sexo == "Mujer"] <- "2"
total$cod_alfa[total$`Sabe leer?` == "Sí"] <- "1"
total$cod_alfa[total$`Sabe leer?` == "No"] <- "2"
total$cod_alfa[total$`Sabe leer?` == "No sabe o no hay dato"] <- "3"
total$cod_variable[total$Variable == 	"media"]                            <- "1"
total$cod_variable[total$Variable == 	"NA"]                               <- "2"
total$cod_variable[total$Variable == 	"basica"]                           <- "3"
total$cod_variable[total$Variable == 	"profesional"]                      <- "4"
total$cod_variable[total$Variable == 	"universitaria"]                    <- "5"
ttcc_etnia_con_codigo_final <- total
ttcc_etnia_con_codigo_final
writexl::write_xlsx(ttcc_etnia_con_codigo_final, "tablas_etnicas/tabla02_etnia.xlsx")
ab <- casen_2011
b <- ab$comuna
c <- ab$z
d <- ab$r2p_cod
e <- ab$sexo
f <- ab$e1
cross_tab =  xtabs(ab$expc_full ~   unlist(b) + unlist(c)  + unlist(d) + unlist(e)  + unlist(f),aggregate(ab$expc_full ~  unlist(b) + unlist(c) + unlist(d) + unlist(e) + unlist(f) ,ab,mean))
tabla <- as.data.frame(cross_tab)
d <-tabla[!(tabla$Freq == 0),]
d$anio <- "2011"
names(d)[1] <- "comuna"
names(d)[2] <- "Variable"
names(d)[3] <- "Origen"
names(d)[4] <- "Sexo"
names(d)[5] <- "Sabe leer?"
names(d)[6] <- "Frecuencia"
names(d)[7] <- "Año"
d_2011 <- d
ab <- casen_2013
b <- ab$comuna
c <- ab$zona
d <- ab$r2_p_cod
e <- ab$sexo
f <- ab$e1
cross_tab =  xtabs(ab$expc ~   unlist(b) + unlist(c)  + unlist(d) + unlist(e)  + unlist(f),aggregate(ab$expc ~  unlist(b) + unlist(c) + unlist(d) + unlist(e) + unlist(f) ,ab,mean))
tabla <- as.data.frame(cross_tab)
d <-tabla[!(tabla$Freq == 0),]
d$anio <- "2013"
names(d)[1] <- "comuna"
names(d)[2] <- "Variable"
names(d)[3] <- "Origen"
names(d)[4] <- "Sexo"
names(d)[5] <- "Sabe leer?"
names(d)[6] <- "Frecuencia"
names(d)[7] <- "Año"
d_2013 <- d
ab <- casen_2015
b <- ab$comuna
c <- ab$zona
d <- ab$r2espp_cod
e <- ab$sexo
f <- ab$e1
cross_tab =  xtabs(ab$expc_todas ~   unlist(b) + unlist(c)  + unlist(d) + unlist(e)  + unlist(f),aggregate(ab$expc_todas ~  unlist(b) + unlist(c) + unlist(d) + unlist(e) + unlist(f) ,ab,mean))
tabla <- as.data.frame(cross_tab)
d <-tabla[!(tabla$Freq == 0),]
d$anio <- "2015"
names(d)[1] <- "comuna"
names(d)[2] <- "Variable"
names(d)[3] <- "Origen"
names(d)[4] <- "Sexo"
names(d)[5] <- "Sabe leer?"
names(d)[6] <- "Frecuencia"
names(d)[7] <- "Año"
d_2015 <- d
ab <- casen_2017
b <- ab$comuna
c <- ab$zona
d <- ab$r2_p_cod
e <- ab$sexo
f <- ab$e1
cross_tab =  xtabs(ab$expc~   unlist(b) + unlist(c)  + unlist(d) + unlist(e)  + unlist(f),aggregate(ab$expc ~  unlist(b) + unlist(c) + unlist(d) + unlist(e) + unlist(f) ,ab,mean))
tabla <- as.data.frame(cross_tab)
d <-tabla[!(tabla$Freq == 0),]
d$anio <- "2017"
names(d)[1] <- "comuna"
names(d)[2] <- "Variable"
names(d)[3] <- "Origen"
names(d)[4] <- "Sexo"
names(d)[5] <- "Sabe leer?"
names(d)[6] <- "Frecuencia"
names(d)[7] <- "Año"
d_2017 <- d
ab <- casen_2020
b <- ab$comuna
c <- ab$zona
d <- ab$r2_pais_esp
e <- ab$sexo
f <- ab$e1
cross_tab =  xtabs(ab$expc ~   unlist(b) + unlist(c)  + unlist(d) + unlist(e)  + unlist(f),aggregate(ab$expc ~  unlist(b) + unlist(c) + unlist(d) + unlist(e)  + unlist(f),ab,mean))
tabla <- as.data.frame(cross_tab)
d <-tabla[!(tabla$Freq == 0),]
d$anio <- "2020"
names(d)[1] <- "comuna"
names(d)[2] <- "Variable"
names(d)[3] <- "Origen"
names(d)[4] <- "Sexo"
names(d)[5] <- "Sabe leer?"
names(d)[6] <- "Frecuencia"
names(d)[7] <- "Año"
d_2020 <- d
union_migra <- rbind(d_2011, d_2013, d_2015, d_2017, d_2020)
union_migra <- mutate_if(union_migra, is.factor, as.character)
union_migra
cod_com <- readRDS("C:/Users/chris/Desktop/archivos grandes/codigos_comunales_2006-2020.rds")
names(cod_com)[2] <- "comuna"
ttcc_migra_con_codigo_final <- merge(x=union_migra, y=cod_com, by="comuna")
ttcc_migra_con_codigo_final$cod_sexo[ttcc_migra_con_codigo_final$Sexo == "Hombre"] <- "1"
ttcc_migra_con_codigo_final$cod_sexo[ttcc_migra_con_codigo_final$Sexo == "Mujer"] <- "2"
ttcc_migra_con_codigo_final$cod_alfa[ttcc_migra_con_codigo_final$`Sabe leer?` == "Sí"] <- "1"
ttcc_migra_con_codigo_final$cod_alfa[ttcc_migra_con_codigo_final$`Sabe leer?` == "No"] <- "2"
ttcc_migra_con_codigo_final$cod_alfa[ttcc_migra_con_codigo_final$`Sabe leer?` == "No sabe o no hay dato"] <- "3"
ttcc_migra_con_codigo_final$cod_variable[ttcc_migra_con_codigo_final$Variable == "NA, no contesta o no está bien especificado"	] <-	'1'
ttcc_migra_con_codigo_final$cod_variable[ttcc_migra_con_codigo_final$Variable != "NA, no contesta o no está bien especificado"	] <-	ttcc_migra_con_codigo_final$Variable
writexl::write_xlsx(ttcc_migra_con_codigo_final, "tablas_migratorias/tabla02_migra.xlsx")
fff <- stack(data_cbind)
fff <- stack(data_cbind)
fff
eee <- unique(fff$values)
eee
library(ggplot2)
library(ggpubr)
library(markdown)
library(shiny)
library(shinythemes)
library(tidyverse)
library(magrittr)
library(lubridate)
library(plotly)
library(xts)
library(dygraphs)
library(kableExtra)
library(knitr)
library("readxl")
library(rsconnect)
library(dplyr)
library(summarytools)
library(epiDisplay)
library(leaflet)
library(haven)
library(epiDisplay)
library("readxl")
library(expss)
library(hrbrthemes)
library(viridis)
library(viridisLite)
library(DescTools)
library(roperators)
library(shinycssloaders)
library(writexl)
library(labelled)
library(tidyverse)
library(haven)
library(readr)
library(sjmisc)
library(WriteXLS)
library(ineq)
library(readstata13)
library(reldist)
library(DT)
casen_2006 <- readRDS("casens_homologadas/casen_2006_homologado.rds")
casen_2009 <- readRDS("casens_homologadas/casen_2009_homologado.rds")
casen_2011 <- readRDS("casens_homologadas/casen_2011_homologado.rds")
casen_2013 <- readRDS("casens_homologadas/casen_2013_homologado.rds")
casen_2015 <- readRDS("casens_homologadas/casen_2015_homologado.rds")
casen_2017 <- readRDS("casens_homologadas/casen_2017_homologado.rds")
casen_2020 <- readRDS("casens_homologadas/casen_2020_homologado.rds")
casen_2006$COMUNA <- as.character(casen_2006$COMUNA)
casen_2006$COMUNA[casen_2006$COMUNA == 'Aisén'] <- 'Aysén'
a <- unique(casen_2006$E8T)
a <- as.data.frame(a)
a
b <- unique(casen_2009$E7T)
b <- as.data.frame(b)
b
c <- unique(casen_2011$e6a)
c <- as.data.frame(c)
c
d <- unique(casen_2013$e6a)
d <- as.data.frame(d)
d
e <- unique(casen_2015$e6a)
e <- as.data.frame(e)
e
f <- unique(casen_2017$e6a)
f <- as.data.frame(f)
f
g <- unique(casen_2020$e6a)
g <- as.data.frame(g)
g
library("qpcR")
data_cbind <- qpcR:::cbind.na(a, b,c,d,e,f,g)           # Bind as columns
data_cbind
fff <- stack(data_cbind)
fff
eee <- unique(fff$values)
eee
qqq <- eee$Column<-paste0("'", eee$values,"']")
qqq <- eee$<-paste0("'", eee$values,"']")
qqq <- eee<-paste0("'", eee$values,"']")
qqq <- eee<-paste0("'", eee,"']")
qqq <- as.data.frame(qqq)
qqq
qqq$cadena <- "dataset[,variable][dataset[,variable]=="
qqq
qqq <- qqq[,c(2,1)]
qqq
writexl::write_xlsx(qqq,"qqq.xlsx")
